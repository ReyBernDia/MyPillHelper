{% extends 'base.html' %}

{% block title %}Identify Medication{% endblock %}

{% block content %}

<h1>Identify a Medication</h1>

<div>
    <form action="/find_meds" id="find_meds" method="POST">
    <label for="imprint"> Imprint </label>
    <input type="text" id="pill_imprint" name="pill_imprint">
    <label for="score"> Score </label>
<!--     <select type="number" id="pill_score" name="pill_score">
        <option value="unknown">Unknown</option>
        <option value="one">1</option>
        <option value="two">2</option>
        <option value="three">3</option>
        <option value="four">4</option>
    </select> -->
    <input type="radio" name="1" value="1">1
    <label for="shape"> Shape </label>
    <select id="pill_shape" name="pill_shape">
        <option value="unknown">unknown</option>
        <option value="bullet">Bullet</option>
        <option value="capsule">Capsule</option>
        <option value="clover">Clover</option>
        <option value="diamond">Diamond</option>
        <option value="double_circle">Double Circle</option>
        <option value="freeform">Free-form</option>
        <option value="gear">Gear</option>
        <option value="heptagon">Heptagon (7 sides)</option>
        <option value="hexagon">Hexagon (6 sides)</option>
        <option value="octagon">Octagon (8 sides)</option>
        <option value="oval">Oval</option>
        <option value="pentagon">Pentagon</option>
        <option value="rectangle">Rectangle</option>
        <option value="round">Round</option>
        <option value="semi-circle">Semi-Circle</option>
        <option value="square">Square</option>
        <option value="tear">Tear</option>
        <option value="trapezoid">Trapezoid</option>
        <option value="triangle">Triangle</option>
    </select>
    <label for="color"> Color </label>
    <select id="pill_color" name="pill_color">
        <option value="Unknown">unknown</option>
        <option value="red">Red</option>
        <option value="orange">Orange</option>
        <option value="yellow">Yellow</option>
        <option value="green">Green</option>
        <option value="turquoise">Turquoise</option>
        <option value="blue">Blue</option>
        <option value="purple">Purple</option>
        <option value="pink">Pink</option>
        <option value="black">Black</option>
        <option value="gray">Gray</option>
        <option value="white">White</option>
        <option value="brown">Brown</option>
    </select>
    <label for="name_of_med"> Medication Name </label>
    <input type="text" id="name_of_med" name="name_of_med">
    <input type="submit" value="Find">
        
    </form>
</div>

 <script>
    "use strict";

      // $('#get-human').on('submit', (evt) => {
      //   evt.preventDefault();

      //   const selectedId = $('#human-id').val();

      //   let url = '/api/human/' + selectedId

      //   $.get(url, (res) => {

      //     $('#fname').html(res.fname);
      //     $('#lname').html(res.lname);
      //     $('#email').html(res.email);
    $('#find_meds').on('submit', (evt) => {
        evt.preventDefault();

        const pillImprint = $('#pill_imprint').val();
        
        const medName = $('#name_of_med').val();

        let pillScore = $('#pill_score').val()

        console.log(pillScore)
        // let new_val = parseInt(pillScore);

        // console.log(new_val);

        let pillShape = $('#pill_shape').val();
        if (pillShape === 'unknown') {
          (pillShape = '');
        }

        let pillColor = $('#pill_color').val();
        if (pillColor === 'Unknown') {
          (pillColor = '');
        }
        console.log(pillColor)

        console.log(typeof pillImprint)
        console.log(pillShape)


        // let url = 'https://datadiscovery.nlm.nih.gov/resource/crzr-uvwg.json?splshape_text=' + pillShape.toUpperCase();

        // let url = 'https://datadiscovery.nlm.nih.gov/resource/crzr-uvwg.json?splimprint=' + pillImprint

        let url = 'https://datadiscovery.nlm.nih.gov/resource/crzr-uvwg.json?splscore=' + pillScore;

        // let url = 'https://datadiscovery.nlm.nih.gov/resource/crzr-uvwg.json?$where=' + 'splimprint%20=%20' + pillImprint + '%20AND%20' + 'splshape_text%20=%20' + pillShape.toUpperCase();

        // https://soda.demo.socrata.com/resource/4tka-6guv.json?$where=magnitude > 3.0 AND source = 'pr'
        https://soda.demo.socrata.com/resource/4tka-6guv.json?$where=magnitude%20%3E%203.0%20AND%20source%20=%20%27pr%27

        console.log(url)
        
        $.ajax({
            url,
            type: "GET",
            data: {
                "$limit" : 3,
                "$$app_token" : '{{APP_TOKEN}}'
            }
               }).done(function(data) {
      
                    alert("Retrieved " + data.length + " records from the dataset!");
                    
                    console.log(data);
                });

    });

    

  </script>

{% endblock %}