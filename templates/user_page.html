{% extends 'base.html' %}
{% block title %} User Profile {% endblock %}
{% block content %}


 
  <nav class="navbar navbar-expand-md w-100">
  <div class="container-fluid">
    <a class="navbar-brand my-0 mr-md-auto" href="/">
        <img src="/static/img/myPillHelper.jpg" alt width="250px" height="125px">
        </a>
        <div class="navbar-links my-2 my-md-0 mr-md-3">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link py-2 text-dark" href="/">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link py-2 text-dark" href="/find_meds">Pill Search</a>
              </li>
              {% if session.get('user_name',None) %}
              <li class="nav-item">
              <a class="nav-link py-2 text-dark" href="/logout">Log Out</a>
              </li>
              {% else %}
              <li class="nav-item">
              <a class="nav-link py-2 text-dark" href="/login">Log In</a>
              </li>
              <li class="nav-item">
              <a class="nav-link py-2 text-dark" href="/register">Register</a>
              </li>
              {% endif %}
            </ul>
    </div>
  </div>
      <div class="user-margin-2 container h-100">
      <h2>User Profile</h2>

      <br>
     </div>
     
    <div class="user-margin-2 my-2 container h-100">

      <h2>Add a medication to your med list</h2>

      <br>
    </div>
    <div class="user-margin-2 container h-100">

      <form action="/user-page" id="add_med" method="POST">
        <div class="container-fluid">
        <label for="med_name">Medication Name:</label>
        <input type="text" id="med_name" name="med_name" required>
        </div>
        <div class="container-fluid">
        <label for="med_name">Strength of Medication:</label>
        <input type="text" id="med_strength" name="med_strength" required>
        </div>
        <div class="container-fluid">
        <label for="qty_per_dose">Quantity Per Dose:</label>  
        <input type="number" id="qty_per_dose" name="qty_per_dose" required>
        </div>
        <div class="container-fluid">
        <label for="dosing">Dosing Schedule:</label>
        <select id="dosing" name="dosing" required>
            <option value="1">Once Daily</option>
            <option value="2">Twice Daily</option>
            <option value="3">Three Times Daily</option>
        </select>
        </div>
        <div class="container-fluid">
        <label for="start_date">Start Date:</label>
        <input type="date" id="start_date" name="start_date" required>
        </div>
        <div class="container-fluid">
        <input type="submit" value="Add Medication">
        </div>
      </form>
    </div>
  </nav>




  
  
    <div class="my-meds container-fluid user-margin-2">
      <h2 class="py-2">My Medications</h2>
        <div class="border">
        {% for key, value in med_options.items() %}
          <div id="user_meds"> 

            <div class="container-fluid py-2">
              <h3 id="med_name"> Medication Name: {{ key }} </h3> 
            </div>

            <div class="container-fluid py-2">
              <form action="/show_schedule_form", method = "POST">
              <input type="submit" value="Schedule Reminders for This Medication">
              <input type="hidden" name="med_strength" value="{{key}}">
              <input type="hidden" id="med_id" name="med_id" value="{{value['med_id']}}">
              </form>
            </div>

            <div class="container-fluid py-2">
              <h5>Strength</h5>
                <p>
                {% for val in value['strength'] %}
                  <li>{{ val }}</li>
                {% endfor %}
                </p>
            </div>

            <div class="container-fluid py-2">
              <img src="{{ value['img_path'][0] }}" width =10% height=10%>
            </div>

            <div class="container-fluid py-3">
              <button class="userMedInfo" id="med_indication"><h5>Indications</h5></button>
              <p id="dict_indications"></p>
            </div>

            <div class="container-fluid py-3">
              <button class="userMedInfo" id="med_dosing"><h5>Dosing Information</h5></button>
              <p id="dict_dosing"></p>
            </div>

            <div class="container-fluid py-3">
              <button class="userMedInfo" id="med_pharm"><h5>Pharmacy Class</h5></button>
              <p id="dict_pharm"></p>
            </div>

            <div class="container-fluid py-3">
              <button class="userMedInfo" id="med_contraindications"><h5>Contraindications</h5></button>
              <p id="dict_contra"></p>
            </div>

            <div class="container-fluid py-3">
              <button class="userMedInfo" id="med_more_info"><h5>More Information for Patients</h5></button>
              <p id="dict_more"></p>
            </div>  

          </div> 
        {% endfor %}
        </div>
    </div>
  


    
    <script>
 
    document.addEventListener('DOMContentLoaded', () => {
        
        $('#med_indication').on('click', (get_med_info) =>  {
            console.log('I am getting med info.');
            const med_id = document.getElementById("med_id");

            const entry = {
                med_id: med_id.value,
            };

            fetch(`${window.origin}/user_data`, {
                method: "POST",
                credentials: "include",
                body: JSON.stringify(entry),
                cache: "no-cache",
                headers: new Headers({
                  "content-type": "application/json"
                })
              })
              .then(function(response) {
                if (response.status !== 200) {
                  console.log(`Looks like there was a problem. Status code: ${response.status}`);
                  return;
                }
                response.json().then(function(data) {
                  console.log(data);
                  const valIndications = (data['indications']);
                  const updateIndications = document.querySelector('#dict_indications');
                  updateIndications.innerHTML = (`${valIndications}`);
                });

              })
              .catch(function(error) {
                console.log("Fetch error: " + error);
            });
        });

        $('#med_dosing').on('click', (get_med_info) =>  {
            console.log('I am getting med info.');
            const med_id = document.getElementById("med_id");

            const entry = {
                med_id: med_id.value,
            };

            fetch(`${window.origin}/user_data`, {
                method: "POST",
                credentials: "include",
                body: JSON.stringify(entry),
                cache: "no-cache",
                headers: new Headers({
                  "content-type": "application/json"
                })
              })
              .then(function(response) {
                if (response.status !== 200) {
                  console.log(`Looks like there was a problem. Status code: ${response.status}`);
                  return;
                }
                response.json().then(function(data) {
                  console.log(data);
                
                  const valDosing = (data['dose_admin']);
                  const updateDosing = document.querySelector('#dict_dosing');
                  updateDosing.innerHTML = (`${valDosing}`);
                });

              })
              .catch(function(error) {
                console.log("Fetch error: " + error);
            });
        });
        $('#med_pharm').on('click', (get_med_info) =>  {
            console.log('I am getting med info.');
            const med_id = document.getElementById("med_id");

            const entry = {
                med_id: med_id.value,
            };

            fetch(`${window.origin}/user_data`, {
                method: "POST",
                credentials: "include",
                body: JSON.stringify(entry),
                cache: "no-cache",
                headers: new Headers({
                  "content-type": "application/json"
                })
              })
              .then(function(response) {
                if (response.status !== 200) {
                  console.log(`Looks like there was a problem. Status code: ${response.status}`);
                  return;
                }
                response.json().then(function(data) {
                  console.log(data);
                
                  const valPharm = (data['pharm_class']);
                  const updatePharm = document.querySelector('#dict_pharm');
                  updatePharm.innerHTML = (`${valPharm}`);
                });

              })
              .catch(function(error) {
                console.log("Fetch error: " + error);
            });
        });
        $('#med_contraindications').on('click', (get_med_info) =>  {
            console.log('I am getting med info.');
            const med_id = document.getElementById("med_id");

            const entry = {
                med_id: med_id.value,
            };

            fetch(`${window.origin}/user_data`, {
                method: "POST",
                credentials: "include",
                body: JSON.stringify(entry),
                cache: "no-cache",
                headers: new Headers({
                  "content-type": "application/json"
                })
              })
              .then(function(response) {
                if (response.status !== 200) {
                  console.log(`Looks like there was a problem. Status code: ${response.status}`);
                  return;
                }
                response.json().then(function(data) {
                  console.log(data);
                
                  const valContra = (data['contraindications']);
                  const updateContra = document.querySelector('#dict_contra');
                  updateContra.innerHTML = (`${valContra}`);
                });

              })
              .catch(function(error) {
                console.log("Fetch error: " + error);
            });
        });
        $('#med_more_info').on('click', (get_med_info) =>  {
            console.log('I am getting med info.');
            const med_id = document.getElementById("med_id");

            const entry = {
                med_id: med_id.value,
            };

            fetch(`${window.origin}/user_data`, {
                method: "POST",
                credentials: "include",
                body: JSON.stringify(entry),
                cache: "no-cache",
                headers: new Headers({
                  "content-type": "application/json"
                })
              })
              .then(function(response) {
                if (response.status !== 200) {
                  console.log(`Looks like there was a problem. Status code: ${response.status}`);
                  return;
                }
                response.json().then(function(data) {
                  console.log(data);
                
                  const valMoreInfo = (data['more_info']);
                  const updateMoreInfo = document.querySelector('#dict_more');
                  updateMoreInfo.innerHTML = (`${valMoreInfo}`);
                });

              })
              .catch(function(error) {
                console.log("Fetch error: " + error);
            });
        });
    });
         
    </script>



{% endblock %}